<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Stocks</title>
    <style>
      * {
        box-sizing: border-box;
      }

      table,
      th,
      td {
        border: 1px solid black;
        border-collapse: collapse;
        margin: auto;
        padding: 5px;
      }

      .center-content {
        display: flex;
        justify-content: center;
      }

      .margin-top {
        margin-top: 20px;
      }

      tr:nth-child(even),
      th {
        background-color: rgb(150, 150, 150);
      }

      form > div.input-group {
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      form > div > input {
        margin-bottom: 15px;
      }

      form {
        display: inline-flex;
        flex-wrap: wrap;
        flex-direction: column;
        gap: 12px;
      }

      form > div.button-group {
        display: flex;
        flex-wrap: wrap;
      }

      form > div.button-group > button {
        flex-grow: 1;
      }

      button {
        background-color: #545481ff;
        color: white;
        border: none;
        border-radius: 3px;
        padding: 5px 10px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        cursor: pointer;
        margin: 1px;
      }
    </style>
  </head>
  <script type="text/javascript">
    let companies = [
      {
        name: 'Johnson & Johnson',
        ticker: 'JNJ',
        price: 174.47,
      },
      {
        name: 'Pfeizer',
        ticker: 'PFE',
        price: 47.39,
      },
      {
        name: 'Maderna',
        ticker: 'MRNA',
        price: 168.04,
      },
      {
        name: 'BioNTech',
        ticker: 'BNTX',
        price: 156,
      },
    ];

    function createEditableCell(value) {
      const cell = document.createElement('td');

      const input = document.createElement('input');

      input.value = value;
      input.type = isNaN(value) ? 'text' : 'number';

      cell.appendChild(input);

      return cell;
    }

    function createCell(text) {
      let cell = document.createElement('td');
      cell.innerText = text;
      return cell;
    }

    function createButton(text, onClick) {
      let button = document.createElement('button');
      button.innerText = text;
      button.onclick = onClick;
      return button;
    }

    function viewRow(company, index) {
      const tbody = document.querySelector('tbody');

      tbody.replaceChild(createRow(company, index), tbody.children[index]);
    }

    function editRow(company, index) {
      const tbody = document.querySelector('tbody');

      tbody.replaceChild(createEditableRow(company), tbody.children[index]);
    }

    function createEditButtons(company) {
      let cell = document.createElement('td');

      cell.appendChild(
        createButton('Save', () => {
          const index = companies.indexOf(company);
          const row = document.querySelector('tbody').children[index];

          company.name = row.children[0].children[0].value;
          company.ticker = row.children[1].children[0].value;
          company.price = row.children[2].children[0].value;

          viewRow(companies[index], index);
        })
      );

      cell.appendChild(
        createButton('Cancel', () => viewRow(company, companies.indexOf(company)))
      );

      return cell;
    }

    function createButtons(company) {
      let cell = document.createElement('td');

      let edit = createButton('Edit', () => {
        let index = companies.indexOf(company);

        editRow(company, index);
      });

      let remove = createButton('Remove', () => {
        let index = companies.indexOf(company);
        companies.splice(index, 1);
        cell.parentElement.remove();
      });

      cell.appendChild(edit);
      cell.appendChild(remove);

      return cell;
    }

    function addCompanyToTable(company) {
      const tbody = document.querySelector('tbody');

      tbody.appendChild(createRow(company));
    }

    function createRow(company) {
      const tr = document.createElement('tr');

      tr.appendChild(createCell(company.name));
      tr.appendChild(createCell(company.ticker));
      tr.appendChild(createCell(company.price));
      tr.appendChild(createButtons(company));

      return tr;
    }

    function createEditableRow(company) {
      const tr = document.createElement('tr');

      tr.appendChild(createEditableCell(company.name));
      tr.appendChild(createEditableCell(company.ticker));
      tr.appendChild(createEditableCell(company.price));
      tr.appendChild(createEditButtons(company));

      return tr;
    }

    function showForm() {
      document.querySelector('form').style.display = 'block';
      document.querySelector('#add').style.display = 'none';
    }

    function hideForm() {
      document.querySelector('form').style.display = 'none';
      document.querySelector('#add').style.display = 'block';
    }
  </script>

  <body>
    <table>
      <thead>
        <tr>
          <th>Company</th>
          <th>Ticker</th>
          <th>Price</th>
          <th></th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="center-content margin-top">
      <form style="display: none">
        <div class="input-group">
          <label for="company">Company</label>
          <input type="text" id="company" />
        </div>
        <div class="input-group">
          <label for="ticker">Ticker</label> <input type="text" id="ticker" />
        </div>
        <div class="input-group">
          <label for="price">Price</label> <input type="number" id="price" />
        </div>
        <div class="button-group">
          <button type="submit">Save</button>

          <button
            type="reset"
            onclick="hideForm()"
          >
            Cancel
          </button>
        </div>
      </form>
      <button id="add" onclick="showForm()">
        Add
      </button>
    </div>

    <script type="text/javascript">
      for (let company of companies) {
        addCompanyToTable(company);
      }
    </script>
  </body>
</html>
